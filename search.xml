<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>Java Socket实现多人聊天系统（图形界面+文件传输功能）</title>
      <link href="/article/648d85bc.html"/>
      <url>/article/648d85bc.html</url>
      
        <content type="html"><![CDATA[<h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p>GitHub地址：<a href="https://github.com/Samven7/multichat-system" target="_blank" rel="noopener">https://github.com/Samven7/multichat-system</a></p><a id="more"></a><h2 id="一、多人聊天系统"><a href="#一、多人聊天系统" class="headerlink" title="一、多人聊天系统"></a>一、多人聊天系统</h2><h3 id="1-1-客户端"><a href="#1-1-客户端" class="headerlink" title="1.1 客户端"></a>1.1 客户端</h3><p>Login.java：登录界面</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Login.java</span></span><br><span class="line"><span class="keyword">package</span> exp5;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.awt.*;</span><br><span class="line"><span class="keyword">import</span> javax.swing.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Login</span> </span>{</span><br><span class="line">    JTextField textField = <span class="keyword">null</span>;</span><br><span class="line">    JPasswordField pwdField = <span class="keyword">null</span>;</span><br><span class="line">    ClientReadAndPrint.LoginListen listener=<span class="keyword">null</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 构造函数</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Login</span><span class="params">()</span> </span>{</span><br><span class="line">        init();</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>{</span><br><span class="line">        JFrame jf = <span class="keyword">new</span> JFrame(<span class="string">"登录"</span>);</span><br><span class="line">        jf.setBounds(<span class="number">500</span>, <span class="number">250</span>, <span class="number">310</span>, <span class="number">210</span>);</span><br><span class="line">        jf.setResizable(<span class="keyword">false</span>);  <span class="comment">// 设置是否缩放</span></span><br><span class="line">        </span><br><span class="line">        JPanel jp1 = <span class="keyword">new</span> JPanel();</span><br><span class="line">        JLabel headJLabel = <span class="keyword">new</span> JLabel(<span class="string">"登录界面"</span>);</span><br><span class="line">        headJLabel.setFont(<span class="keyword">new</span> Font(<span class="keyword">null</span>, <span class="number">0</span>, <span class="number">35</span>));  <span class="comment">// 设置文本的字体类型、样式和大小</span></span><br><span class="line">        jp1.add(headJLabel);</span><br><span class="line">        </span><br><span class="line">        JPanel jp2 = <span class="keyword">new</span> JPanel();</span><br><span class="line">        JLabel nameJLabel = <span class="keyword">new</span> JLabel(<span class="string">"用户名："</span>);</span><br><span class="line">        textField = <span class="keyword">new</span> JTextField(<span class="number">20</span>);</span><br><span class="line">        JLabel pwdJLabel = <span class="keyword">new</span> JLabel(<span class="string">"密码：    "</span>);</span><br><span class="line">        pwdField = <span class="keyword">new</span> JPasswordField(<span class="number">20</span>);</span><br><span class="line">        JButton loginButton = <span class="keyword">new</span> JButton(<span class="string">"登录"</span>);</span><br><span class="line">        JButton registerButton = <span class="keyword">new</span> JButton(<span class="string">"注册"</span>);  <span class="comment">// 没设置功能</span></span><br><span class="line">        jp2.add(nameJLabel);</span><br><span class="line">        jp2.add(textField);</span><br><span class="line">        jp2.add(pwdJLabel);</span><br><span class="line">        jp2.add(pwdField);</span><br><span class="line">        jp2.add(loginButton);</span><br><span class="line">        jp2.add(registerButton);</span><br><span class="line">        </span><br><span class="line">        JPanel jp = <span class="keyword">new</span> JPanel(<span class="keyword">new</span> BorderLayout());  <span class="comment">// BorderLayout布局</span></span><br><span class="line">        jp.add(jp1, BorderLayout.NORTH);</span><br><span class="line">        jp.add(jp2, BorderLayout.CENTER);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 设置监控</span></span><br><span class="line">        listener = <span class="keyword">new</span> ClientReadAndPrint().new LoginListen();  <span class="comment">// 新建监听类</span></span><br><span class="line">        listener.setJTextField(textField);  <span class="comment">// 调用PoliceListen类的方法</span></span><br><span class="line">        listener.setJPasswordField(pwdField);</span><br><span class="line">        listener.setJFrame(jf);</span><br><span class="line">        pwdField.addActionListener(listener);  <span class="comment">// 密码框添加监听</span></span><br><span class="line">        loginButton.addActionListener(listener);  <span class="comment">// 按钮添加监听</span></span><br><span class="line">        </span><br><span class="line">        jf.add(jp);</span><br><span class="line">        jf.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);  <span class="comment">// 设置关闭图标作用</span></span><br><span class="line">        jf.setVisible(<span class="keyword">true</span>);  <span class="comment">// 设置可见</span></span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>ChatView.java：登录成功后的个人聊天界面</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ChatView.java</span></span><br><span class="line"><span class="keyword">package</span> exp5;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.awt.event.ActionEvent;</span><br><span class="line"><span class="keyword">import</span> java.awt.event.ActionListener;</span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> javax.swing.*;</span><br><span class="line"><span class="keyword">import</span> javax.swing.filechooser.FileNameExtensionFilter;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ChatView</span> </span>{</span><br><span class="line">    String userName;  <span class="comment">//由客户端登录时设置</span></span><br><span class="line">    JTextField text;</span><br><span class="line">    JTextArea textArea;</span><br><span class="line">    ClientReadAndPrint.ChatViewListen listener;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 构造函数</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ChatView</span><span class="params">(String userName)</span> </span>{</span><br><span class="line">        <span class="keyword">this</span>.userName = userName ;</span><br><span class="line">        init();</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">// 初始化函数</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>{</span><br><span class="line">        JFrame jf = <span class="keyword">new</span> JFrame(<span class="string">"客户端"</span>);</span><br><span class="line">        jf.setBounds(<span class="number">500</span>,<span class="number">200</span>,<span class="number">400</span>,<span class="number">330</span>);  <span class="comment">//设置坐标和大小</span></span><br><span class="line">        jf.setResizable(<span class="keyword">false</span>);  <span class="comment">// 缩放为不能缩放</span></span><br><span class="line">        </span><br><span class="line">        JPanel jp = <span class="keyword">new</span> JPanel();</span><br><span class="line">        JLabel lable = <span class="keyword">new</span> JLabel(<span class="string">"用户："</span> + userName);</span><br><span class="line">        textArea = <span class="keyword">new</span> JTextArea(<span class="string">"***************登录成功，欢迎来到多人聊天室！****************\n"</span>,<span class="number">12</span>, <span class="number">35</span>);</span><br><span class="line">        textArea.setEditable(<span class="keyword">false</span>);  <span class="comment">// 设置为不可修改</span></span><br><span class="line">        JScrollPane scroll = <span class="keyword">new</span> JScrollPane(textArea);  <span class="comment">// 设置滚动面板（装入textArea）</span></span><br><span class="line">        scroll.setVerticalScrollBarPolicy(JScrollPane.VERTICAL_SCROLLBAR_ALWAYS);  <span class="comment">// 显示垂直条</span></span><br><span class="line">        jp.add(lable);</span><br><span class="line">        jp.add(scroll);</span><br><span class="line">        </span><br><span class="line">        text = <span class="keyword">new</span> JTextField(<span class="number">20</span>);</span><br><span class="line">        JButton button = <span class="keyword">new</span> JButton(<span class="string">"发送"</span>);</span><br><span class="line">        JButton openFileBtn = <span class="keyword">new</span> JButton(<span class="string">"发送文件"</span>);</span><br><span class="line">        jp.add(text);</span><br><span class="line">        jp.add(button);</span><br><span class="line">        jp.add(openFileBtn);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 设置“打开文件”监听</span></span><br><span class="line">        openFileBtn.addActionListener(<span class="keyword">new</span> ActionListener() {</span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">actionPerformed</span><span class="params">(ActionEvent e)</span> </span>{</span><br><span class="line">                showFileOpenDialog(jf);</span><br><span class="line">            }</span><br><span class="line">        });</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 设置“发送”监听</span></span><br><span class="line">        listener = <span class="keyword">new</span> ClientReadAndPrint().new ChatViewListen();</span><br><span class="line">        listener.setJTextField(text);  <span class="comment">// 调用PoliceListen类的方法</span></span><br><span class="line">        listener.setJTextArea(textArea);</span><br><span class="line">        listener.setChatViewJf(jf);</span><br><span class="line">        text.addActionListener(listener);  <span class="comment">// 文本框添加监听</span></span><br><span class="line">        button.addActionListener(listener);  <span class="comment">// 按钮添加监听</span></span><br><span class="line">        </span><br><span class="line">        jf.add(jp);</span><br><span class="line">        jf.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);  <span class="comment">// 设置右上角关闭图标的作用</span></span><br><span class="line">        jf.setVisible(<span class="keyword">true</span>);  <span class="comment">// 设置可见</span></span><br><span class="line">    }</span><br><span class="line">    <span class="comment">// “打开文件”调用函数</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">showFileOpenDialog</span><span class="params">(JFrame parent)</span> </span>{</span><br><span class="line">        <span class="comment">// 创建一个默认的文件选择器</span></span><br><span class="line">        JFileChooser fileChooser = <span class="keyword">new</span> JFileChooser();</span><br><span class="line">        <span class="comment">// 设置默认显示的文件夹</span></span><br><span class="line">        fileChooser.setCurrentDirectory(<span class="keyword">new</span> File(<span class="string">"C:/Users/Samven/Desktop"</span>));</span><br><span class="line">        <span class="comment">// 添加可用的文件过滤器（FileNameExtensionFilter 的第一个参数是描述, 后面是需要过滤的文件扩展名）</span></span><br><span class="line"><span class="comment">//        fileChooser.addChoosableFileFilter(new FileNameExtensionFilter("(txt)", "txt"));</span></span><br><span class="line">        <span class="comment">// 设置默认使用的文件过滤器（FileNameExtensionFilter 的第一个参数是描述, 后面是需要过滤的文件扩展名 可变参数）</span></span><br><span class="line">        fileChooser.setFileFilter(<span class="keyword">new</span> FileNameExtensionFilter(<span class="string">"(txt)"</span>, <span class="string">"txt"</span>));</span><br><span class="line">        <span class="comment">// 打开文件选择框（线程将被堵塞，知道选择框被关闭）</span></span><br><span class="line">        <span class="keyword">int</span> result = fileChooser.showOpenDialog(parent);  <span class="comment">// 对话框将会尽量显示在靠近 parent 的中心</span></span><br><span class="line">        <span class="comment">// 点击确定</span></span><br><span class="line">        <span class="keyword">if</span>(result == JFileChooser.APPROVE_OPTION) {</span><br><span class="line">            <span class="comment">// 获取路径</span></span><br><span class="line">            File file = fileChooser.getSelectedFile();</span><br><span class="line">            String path = file.getAbsolutePath();</span><br><span class="line">            ClientFileThread.outFileToServer(path);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>Client.java：客户端</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Client.java</span></span><br><span class="line"><span class="keyword">package</span> exp5;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.net.*;</span><br><span class="line"><span class="keyword">import</span> javax.swing.*;</span><br><span class="line"><span class="keyword">import</span> java.awt.event.*;</span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Client</span> </span>{</span><br><span class="line">    <span class="comment">// 主函数，新建登录窗口</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>{</span><br><span class="line">        <span class="keyword">new</span> Login();</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *  负责客户端的读和写，以及登录和发送的监听</span></span><br><span class="line"><span class="comment"> *  之所以把登录和发送的监听放在这里，是因为要共享一些数据，比如mySocket,textArea</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ClientReadAndPrint</span> <span class="keyword">extends</span> <span class="title">Thread</span></span>{</span><br><span class="line">    <span class="keyword">static</span> Socket mySocket = <span class="keyword">null</span>;  <span class="comment">// 一定要加上static，否则新建线程时会清空</span></span><br><span class="line">    <span class="keyword">static</span> JTextField textInput;</span><br><span class="line">    <span class="keyword">static</span> JTextArea textShow;</span><br><span class="line">    <span class="keyword">static</span> JFrame chatViewJFrame;</span><br><span class="line">    <span class="keyword">static</span> BufferedReader in = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">static</span> PrintWriter out = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">static</span> String userName;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 用于接收从服务端发送来的消息</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            in = <span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> InputStreamReader(mySocket.getInputStream()));  <span class="comment">// 输入流</span></span><br><span class="line">            <span class="keyword">while</span> (<span class="keyword">true</span>) {</span><br><span class="line">                String str = in.readLine();  <span class="comment">// 获取服务端发送的信息</span></span><br><span class="line">                textShow.append(str + <span class="string">'\n'</span>);  <span class="comment">// 添加进聊天客户端的文本区域</span></span><br><span class="line">                textShow.setCaretPosition(textShow.getDocument().getLength());  <span class="comment">// 设置滚动条在最下面</span></span><br><span class="line">            }</span><br><span class="line">        } <span class="keyword">catch</span> (Exception e) {}</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**********************登录监听(内部类)**********************/</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">LoginListen</span> <span class="keyword">implements</span> <span class="title">ActionListener</span></span>{</span><br><span class="line">        JTextField textField;</span><br><span class="line">        JPasswordField pwdField;</span><br><span class="line">        JFrame loginJFrame;  <span class="comment">// 登录窗口本身</span></span><br><span class="line">        </span><br><span class="line">        ChatView chatView = <span class="keyword">null</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setJTextField</span><span class="params">(JTextField textField)</span> </span>{</span><br><span class="line">            <span class="keyword">this</span>.textField = textField;</span><br><span class="line">        }</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setJPasswordField</span><span class="params">(JPasswordField pwdField)</span> </span>{</span><br><span class="line">            <span class="keyword">this</span>.pwdField = pwdField;</span><br><span class="line">        }</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setJFrame</span><span class="params">(JFrame jFrame)</span> </span>{</span><br><span class="line">            <span class="keyword">this</span>.loginJFrame = jFrame;</span><br><span class="line">        }</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">actionPerformed</span><span class="params">(ActionEvent event)</span> </span>{</span><br><span class="line">            userName = textField.getText();</span><br><span class="line">            String userPwd = String.valueOf(pwdField.getPassword());  <span class="comment">// getPassword方法获得char数组</span></span><br><span class="line">            <span class="keyword">if</span>(userName.length() &gt;= <span class="number">1</span> &amp;&amp; userPwd.equals(<span class="string">"123"</span>)) {  <span class="comment">// 密码为123并且用户名长度大于等于1</span></span><br><span class="line">                chatView = <span class="keyword">new</span> ChatView(userName);  <span class="comment">// 新建聊天窗口,设置聊天窗口的用户名（静态）</span></span><br><span class="line">                <span class="comment">// 建立和服务器的联系</span></span><br><span class="line">                <span class="keyword">try</span> {</span><br><span class="line">                    InetAddress addr = InetAddress.getByName(<span class="keyword">null</span>);  <span class="comment">// 获取主机地址</span></span><br><span class="line">                    mySocket = <span class="keyword">new</span> Socket(addr,<span class="number">8081</span>);  <span class="comment">// 客户端套接字</span></span><br><span class="line">                    loginJFrame.setVisible(<span class="keyword">false</span>);  <span class="comment">// 隐藏登录窗口</span></span><br><span class="line">                    out = <span class="keyword">new</span> PrintWriter(mySocket.getOutputStream());  <span class="comment">// 输出流</span></span><br><span class="line">                    out.println(<span class="string">"用户【"</span> + userName + <span class="string">"】进入聊天室！"</span>);  <span class="comment">// 发送用户名给服务器</span></span><br><span class="line">                    out.flush();  <span class="comment">// 清空缓冲区out中的数据</span></span><br><span class="line">                } <span class="keyword">catch</span> (IOException e) {</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                }</span><br><span class="line">                <span class="comment">// 新建普通读写线程并启动</span></span><br><span class="line">                ClientReadAndPrint readAndPrint = <span class="keyword">new</span> ClientReadAndPrint();</span><br><span class="line">                readAndPrint.start();</span><br><span class="line">                <span class="comment">// 新建文件读写线程并启动</span></span><br><span class="line">                ClientFileThread fileThread = <span class="keyword">new</span> ClientFileThread(userName, chatViewJFrame, out);</span><br><span class="line">                fileThread.start();</span><br><span class="line">            }</span><br><span class="line">            <span class="keyword">else</span> {</span><br><span class="line">                JOptionPane.showMessageDialog(loginJFrame, <span class="string">"账号或密码错误，请重新输入！"</span>, <span class="string">"提示"</span>, JOptionPane.WARNING_MESSAGE);</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**********************聊天界面监听(内部类)**********************/</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">ChatViewListen</span> <span class="keyword">implements</span> <span class="title">ActionListener</span></span>{</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setJTextField</span><span class="params">(JTextField text)</span> </span>{</span><br><span class="line">            textInput = text;  <span class="comment">// 放在外部类，因为其它地方也要用到</span></span><br><span class="line">        }</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setJTextArea</span><span class="params">(JTextArea textArea)</span> </span>{</span><br><span class="line">            textShow = textArea;  <span class="comment">// 放在外部类，因为其它地方也要用到</span></span><br><span class="line">        }</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setChatViewJf</span><span class="params">(JFrame jFrame)</span> </span>{</span><br><span class="line">            chatViewJFrame = jFrame;  <span class="comment">// 放在外部类，因为其它地方也要用到</span></span><br><span class="line">            <span class="comment">// 设置关闭聊天界面的监听</span></span><br><span class="line">            chatViewJFrame.addWindowListener(<span class="keyword">new</span> WindowAdapter() {</span><br><span class="line">                <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">windowClosing</span><span class="params">(WindowEvent e)</span> </span>{</span><br><span class="line">                    out.println(<span class="string">"用户【"</span> + userName + <span class="string">"】离开聊天室！"</span>);</span><br><span class="line">                    out.flush();</span><br><span class="line">                    System.exit(<span class="number">0</span>);</span><br><span class="line">                }</span><br><span class="line">            });</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">// 监听执行函数</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">actionPerformed</span><span class="params">(ActionEvent event)</span> </span>{</span><br><span class="line">            <span class="keyword">try</span> {</span><br><span class="line">                String str = textInput.getText();</span><br><span class="line">                <span class="comment">// 文本框内容为空</span></span><br><span class="line">                <span class="keyword">if</span>(<span class="string">""</span>.equals(str)) {</span><br><span class="line">                    textInput.grabFocus();  <span class="comment">// 设置焦点（可行）</span></span><br><span class="line">                    <span class="comment">// 弹出消息对话框（警告消息）</span></span><br><span class="line">                    JOptionPane.showMessageDialog(chatViewJFrame, <span class="string">"输入为空，请重新输入！"</span>, <span class="string">"提示"</span>, JOptionPane.WARNING_MESSAGE);</span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line">                }</span><br><span class="line">                out.println(userName + <span class="string">"说："</span> + str);  <span class="comment">// 输出给服务端</span></span><br><span class="line">                out.flush();  <span class="comment">// 清空缓冲区out中的数据</span></span><br><span class="line">                </span><br><span class="line">                textInput.setText(<span class="string">""</span>);  <span class="comment">// 清空文本框</span></span><br><span class="line">                textInput.grabFocus();  <span class="comment">// 设置焦点（可行）</span></span><br><span class="line"><span class="comment">//textInput.requestFocus(true);  // 设置焦点（可行）</span></span><br><span class="line">            } <span class="keyword">catch</span> (Exception e) {}</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>ClientFileThread.java：文件传输功能（客户端）</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ClientFileThread.java</span></span><br><span class="line"><span class="keyword">package</span> exp5;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.net.*;</span><br><span class="line"><span class="keyword">import</span> javax.swing.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ClientFileThread</span> <span class="keyword">extends</span> <span class="title">Thread</span></span>{</span><br><span class="line">    <span class="keyword">private</span> Socket socket = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">private</span> JFrame chatViewJFrame = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">static</span> String userName = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">static</span> PrintWriter out = <span class="keyword">null</span>;  <span class="comment">// 普通消息的发送（Server.java传来的值）</span></span><br><span class="line">    <span class="keyword">static</span> DataInputStream fileIn = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">static</span> DataOutputStream fileOut = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">static</span> DataInputStream fileReader = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">static</span> DataOutputStream fileWriter = <span class="keyword">null</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ClientFileThread</span><span class="params">(String userName, JFrame chatViewJFrame, PrintWriter out)</span> </span>{</span><br><span class="line">        ClientFileThread.userName = userName;</span><br><span class="line">        <span class="keyword">this</span>.chatViewJFrame = chatViewJFrame;</span><br><span class="line">        ClientFileThread.out = out;</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 客户端接收文件</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            InetAddress addr = InetAddress.getByName(<span class="keyword">null</span>);  <span class="comment">// 获取主机地址</span></span><br><span class="line">            socket = <span class="keyword">new</span> Socket(addr, <span class="number">8090</span>);  <span class="comment">// 客户端套接字</span></span><br><span class="line">            fileIn = <span class="keyword">new</span> DataInputStream(socket.getInputStream());  <span class="comment">// 输入流</span></span><br><span class="line">            fileOut = <span class="keyword">new</span> DataOutputStream(socket.getOutputStream());  <span class="comment">// 输出流</span></span><br><span class="line">            <span class="comment">// 接收文件</span></span><br><span class="line">            <span class="keyword">while</span>(<span class="keyword">true</span>) {</span><br><span class="line">                String textName = fileIn.readUTF();</span><br><span class="line">                <span class="keyword">long</span> totleLength = fileIn.readLong();</span><br><span class="line">                <span class="keyword">int</span> result = JOptionPane.showConfirmDialog(chatViewJFrame, <span class="string">"是否接受？"</span>, <span class="string">"提示"</span>,</span><br><span class="line">                                                           JOptionPane.YES_NO_OPTION);</span><br><span class="line">                <span class="keyword">int</span> length = -<span class="number">1</span>;</span><br><span class="line">                <span class="keyword">byte</span>[] buff = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">1024</span>];</span><br><span class="line">                <span class="keyword">long</span> curLength = <span class="number">0</span>;</span><br><span class="line">                <span class="comment">// 提示框选择结果，0为确定，1位取消</span></span><br><span class="line">                <span class="keyword">if</span>(result == <span class="number">0</span>){</span><br><span class="line"><span class="comment">//out.println("【" + userName + "选择了接收文件！】");</span></span><br><span class="line"><span class="comment">//out.flush();</span></span><br><span class="line">                    File userFile = <span class="keyword">new</span> File(<span class="string">"C:\\Users\\Samven\\Desktop\\接受文件\\"</span> + userName);</span><br><span class="line">                    <span class="keyword">if</span>(!userFile.exists()) {  <span class="comment">// 新建当前用户的文件夹</span></span><br><span class="line">                        userFile.mkdir();</span><br><span class="line">                    }</span><br><span class="line">                    File file = <span class="keyword">new</span> File(<span class="string">"C:\\Users\\Samven\\Desktop\\接受文件\\"</span> + userName + <span class="string">"\\"</span>+ textName);</span><br><span class="line">                    fileWriter = <span class="keyword">new</span> DataOutputStream(<span class="keyword">new</span> FileOutputStream(file));</span><br><span class="line">                    <span class="keyword">while</span>((length = fileIn.read(buff)) &gt; <span class="number">0</span>) {  <span class="comment">// 把文件写进本地</span></span><br><span class="line">                        fileWriter.write(buff, <span class="number">0</span>, length);</span><br><span class="line">                        fileWriter.flush();</span><br><span class="line">                        curLength += length;</span><br><span class="line"><span class="comment">//out.println("【接收进度:" + curLength/totleLength*100 + "%】");</span></span><br><span class="line"><span class="comment">//out.flush();</span></span><br><span class="line">                        <span class="keyword">if</span>(curLength == totleLength) {  <span class="comment">// 强制结束</span></span><br><span class="line">                            <span class="keyword">break</span>;</span><br><span class="line">                        }</span><br><span class="line">                    }</span><br><span class="line">                    out.println(<span class="string">"【"</span> + userName + <span class="string">"接收了文件！】"</span>);</span><br><span class="line">                    out.flush();</span><br><span class="line">                    <span class="comment">// 提示文件存放地址</span></span><br><span class="line">                    JOptionPane.showMessageDialog(chatViewJFrame, <span class="string">"文件存放地址：\n"</span> +</span><br><span class="line">                            <span class="string">"C:\\Users\\Samven\\Desktop\\接受文件\\"</span> +</span><br><span class="line">                            userName + <span class="string">"\\"</span> + textName, <span class="string">"提示"</span>, JOptionPane.INFORMATION_MESSAGE);</span><br><span class="line">                }</span><br><span class="line">                <span class="keyword">else</span> {  <span class="comment">// 不接受文件</span></span><br><span class="line">                    <span class="keyword">while</span>((length = fileIn.read(buff)) &gt; <span class="number">0</span>) {</span><br><span class="line">                        curLength += length;</span><br><span class="line">                        <span class="keyword">if</span>(curLength == totleLength) {  <span class="comment">// 强制结束</span></span><br><span class="line">                            <span class="keyword">break</span>;</span><br><span class="line">                        }</span><br><span class="line">                    }</span><br><span class="line">                }</span><br><span class="line">                fileWriter.close();</span><br><span class="line">            }</span><br><span class="line">        } <span class="keyword">catch</span> (Exception e) {}</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 客户端发送文件</span></span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">outFileToServer</span><span class="params">(String path)</span> </span>{</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            File file = <span class="keyword">new</span> File(path);</span><br><span class="line">            fileReader = <span class="keyword">new</span> DataInputStream(<span class="keyword">new</span> FileInputStream(file));</span><br><span class="line">            fileOut.writeUTF(file.getName());  <span class="comment">// 发送文件名字</span></span><br><span class="line">            fileOut.flush();</span><br><span class="line">            fileOut.writeLong(file.length());  <span class="comment">// 发送文件长度</span></span><br><span class="line">            fileOut.flush();</span><br><span class="line">            <span class="keyword">int</span> length = -<span class="number">1</span>;</span><br><span class="line">            <span class="keyword">byte</span>[] buff = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">1024</span>];</span><br><span class="line">            <span class="keyword">while</span> ((length = fileReader.read(buff)) &gt; <span class="number">0</span>) {  <span class="comment">// 发送内容</span></span><br><span class="line">                </span><br><span class="line">                fileOut.write(buff, <span class="number">0</span>, length);</span><br><span class="line">                fileOut.flush();</span><br><span class="line">            }</span><br><span class="line">            </span><br><span class="line">            out.println(<span class="string">"【"</span> + userName + <span class="string">"已成功发送文件！】"</span>);</span><br><span class="line">            out.flush();</span><br><span class="line">        } <span class="keyword">catch</span> (Exception e) {}</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h3 id="1-2-服务器端"><a href="#1-2-服务器端" class="headerlink" title="1.2 服务器端"></a>1.2 服务器端</h3><p>MultiChat.java：多人聊天系统界面（服务器端）</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// MultiChat.java</span></span><br><span class="line"><span class="keyword">package</span> exp5;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.awt.event.WindowAdapter;</span><br><span class="line"><span class="keyword">import</span> java.awt.event.WindowEvent;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.swing.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MultiChat</span> </span>{</span><br><span class="line">    JTextArea textArea;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 用于向文本区域添加信息</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">setTextArea</span><span class="params">(String str)</span> </span>{</span><br><span class="line">        textArea.append(str+<span class="string">'\n'</span>);</span><br><span class="line">        textArea.setCaretPosition(textArea.getDocument().getLength());  <span class="comment">// 设置滚动条在最下面</span></span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 构造函数</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MultiChat</span><span class="params">()</span> </span>{</span><br><span class="line">        init();</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>{</span><br><span class="line">        JFrame jf = <span class="keyword">new</span> JFrame(<span class="string">"服务器端"</span>);</span><br><span class="line">        jf.setBounds(<span class="number">500</span>,<span class="number">100</span>,<span class="number">450</span>,<span class="number">500</span>);  <span class="comment">// 设置窗口坐标和大小</span></span><br><span class="line">        jf.setResizable(<span class="keyword">false</span>);  <span class="comment">// 设置为不可缩放</span></span><br><span class="line">        </span><br><span class="line">        JPanel jp = <span class="keyword">new</span> JPanel();  <span class="comment">// 新建容器</span></span><br><span class="line">        JLabel lable = <span class="keyword">new</span> JLabel(<span class="string">"==欢迎来到多人聊天系统（服务器端）=="</span>);</span><br><span class="line">        textArea = <span class="keyword">new</span> JTextArea(<span class="number">23</span>, <span class="number">38</span>);  <span class="comment">// 新建文本区域并设置长宽</span></span><br><span class="line">        textArea.setEditable(<span class="keyword">false</span>);  <span class="comment">// 设置为不可修改</span></span><br><span class="line">        JScrollPane scroll = <span class="keyword">new</span> JScrollPane(textArea);  <span class="comment">// 设置滚动面板（装入textArea）</span></span><br><span class="line">        scroll.setVerticalScrollBarPolicy(ScrollPaneConstants.VERTICAL_SCROLLBAR_ALWAYS);  <span class="comment">// 显示垂直条</span></span><br><span class="line">        jp.add(lable);</span><br><span class="line">        jp.add(scroll);</span><br><span class="line">        </span><br><span class="line">        jf.addWindowListener(<span class="keyword">new</span> WindowAdapter() {</span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">windowClosing</span><span class="params">(WindowEvent e)</span> </span>{</span><br><span class="line">                System.exit(<span class="number">0</span>);</span><br><span class="line">            }</span><br><span class="line">        });</span><br><span class="line">        </span><br><span class="line">        jf.add(jp);</span><br><span class="line">        jf.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);  <span class="comment">// 设置关闭图标作用</span></span><br><span class="line">        jf.setVisible(<span class="keyword">true</span>);  <span class="comment">// 设置可见</span></span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>Server.java：服务器端</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Server.java</span></span><br><span class="line"><span class="keyword">package</span> exp5;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.net.*;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Server</span></span>{</span><br><span class="line">    <span class="keyword">static</span> ServerSocket server = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">static</span> Socket socket = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">static</span> List&lt;Socket&gt; list = <span class="keyword">new</span> ArrayList&lt;Socket&gt;();  <span class="comment">// 存储客户端</span></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>{</span><br><span class="line">        MultiChat multiChat = <span class="keyword">new</span> MultiChat();  <span class="comment">// 新建聊天系统界面</span></span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            <span class="comment">// 在服务器端对客户端开启文件传输的线程</span></span><br><span class="line">            ServerFileThread serverFileThread = <span class="keyword">new</span> ServerFileThread();</span><br><span class="line">            serverFileThread.start();</span><br><span class="line">            server = <span class="keyword">new</span> ServerSocket(<span class="number">8081</span>);  <span class="comment">// 服务器端套接字（只能建立一次）</span></span><br><span class="line">            <span class="comment">// 等待连接并开启相应线程</span></span><br><span class="line">            <span class="keyword">while</span> (<span class="keyword">true</span>) {</span><br><span class="line">                socket = server.accept();  <span class="comment">// 等待连接</span></span><br><span class="line">                list.add(socket);  <span class="comment">// 添加当前客户端到列表</span></span><br><span class="line">                <span class="comment">// 在服务器端对客户端开启相应的线程</span></span><br><span class="line">                ServerReadAndPrint readAndPrint = <span class="keyword">new</span> ServerReadAndPrint(socket, multiChat);</span><br><span class="line">                readAndPrint.start();</span><br><span class="line">            }</span><br><span class="line">        } <span class="keyword">catch</span> (IOException e1) {</span><br><span class="line">            e1.printStackTrace();  <span class="comment">// 出现异常则打印出异常的位置</span></span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *  服务器端读写类线程</span></span><br><span class="line"><span class="comment"> *  用于服务器端读取客户端的信息，并把信息发送给所有客户端</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ServerReadAndPrint</span> <span class="keyword">extends</span> <span class="title">Thread</span></span>{</span><br><span class="line">    Socket nowSocket = <span class="keyword">null</span>;</span><br><span class="line">    MultiChat multiChat = <span class="keyword">null</span>;</span><br><span class="line">    BufferedReader in =<span class="keyword">null</span>;</span><br><span class="line">    PrintWriter out = <span class="keyword">null</span>;</span><br><span class="line">    <span class="comment">// 构造函数</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ServerReadAndPrint</span><span class="params">(Socket s, MultiChat multiChat)</span> </span>{</span><br><span class="line">        <span class="keyword">this</span>.multiChat = multiChat;  <span class="comment">// 获取多人聊天系统界面</span></span><br><span class="line">        <span class="keyword">this</span>.nowSocket = s;  <span class="comment">// 获取当前客户端</span></span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            in = <span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> InputStreamReader(nowSocket.getInputStream()));  <span class="comment">// 输入流</span></span><br><span class="line">            <span class="comment">// 获取客户端信息并把信息发送给所有客户端</span></span><br><span class="line">            <span class="keyword">while</span> (<span class="keyword">true</span>) {</span><br><span class="line">                String str = in.readLine();</span><br><span class="line">                <span class="comment">// 发送给所有客户端</span></span><br><span class="line">                <span class="keyword">for</span>(Socket socket: Server.list) {</span><br><span class="line">                    out = <span class="keyword">new</span> PrintWriter(socket.getOutputStream());  <span class="comment">// 对每个客户端新建相应的socket套接字</span></span><br><span class="line">                    <span class="keyword">if</span>(socket == nowSocket) {  <span class="comment">// 发送给当前客户端</span></span><br><span class="line">                        out.println(<span class="string">"(你)"</span> + str);</span><br><span class="line">                    }</span><br><span class="line">                    <span class="keyword">else</span> {  <span class="comment">// 发送给其它客户端</span></span><br><span class="line">                        out.println(str);</span><br><span class="line">                    }</span><br><span class="line">                    out.flush();  <span class="comment">// 清空out中的缓存</span></span><br><span class="line">                }</span><br><span class="line">                <span class="comment">// 调用自定义函数输出到图形界面</span></span><br><span class="line">                multiChat.setTextArea(str);</span><br><span class="line">            }</span><br><span class="line">        } <span class="keyword">catch</span> (Exception e) {</span><br><span class="line">            Server.list.remove(nowSocket);  <span class="comment">// 线程关闭，移除相应套接字</span></span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>ServerFileThread.java：文件传输功能（服务器端）</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ServerFileThread.java</span></span><br><span class="line"><span class="keyword">package</span> exp5;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.net.*;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ServerFileThread</span> <span class="keyword">extends</span> <span class="title">Thread</span></span>{</span><br><span class="line">    ServerSocket server = <span class="keyword">null</span>;</span><br><span class="line">    Socket socket = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">static</span> List&lt;Socket&gt; list = <span class="keyword">new</span> ArrayList&lt;Socket&gt;();  <span class="comment">// 存储客户端</span></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            server = <span class="keyword">new</span> ServerSocket(<span class="number">8090</span>);</span><br><span class="line">            <span class="keyword">while</span>(<span class="keyword">true</span>) {</span><br><span class="line">                socket = server.accept();</span><br><span class="line">                list.add(socket);</span><br><span class="line">                <span class="comment">// 开启文件传输线程</span></span><br><span class="line">                FileReadAndWrite fileReadAndWrite = <span class="keyword">new</span> FileReadAndWrite(socket);</span><br><span class="line">                fileReadAndWrite.start();</span><br><span class="line">            }</span><br><span class="line">        } <span class="keyword">catch</span> (IOException e) {</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FileReadAndWrite</span> <span class="keyword">extends</span> <span class="title">Thread</span> </span>{</span><br><span class="line">    <span class="keyword">private</span> Socket nowSocket = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">private</span> DataInputStream input = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">private</span> DataOutputStream output = <span class="keyword">null</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">FileReadAndWrite</span><span class="params">(Socket socket)</span> </span>{</span><br><span class="line">        <span class="keyword">this</span>.nowSocket = socket;</span><br><span class="line">    }</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            input = <span class="keyword">new</span> DataInputStream(nowSocket.getInputStream());  <span class="comment">// 输入流</span></span><br><span class="line">            <span class="keyword">while</span> (<span class="keyword">true</span>) {</span><br><span class="line">                <span class="comment">// 获取文件名字和文件长度</span></span><br><span class="line">                String textName = input.readUTF();</span><br><span class="line">                <span class="keyword">long</span> textLength = input.readLong();</span><br><span class="line">                <span class="comment">// 发送文件名字和文件长度给所有客户端</span></span><br><span class="line">                <span class="keyword">for</span>(Socket socket: ServerFileThread.list) {</span><br><span class="line">                    output = <span class="keyword">new</span> DataOutputStream(socket.getOutputStream());  <span class="comment">// 输出流</span></span><br><span class="line">                    <span class="keyword">if</span>(socket != nowSocket) {  <span class="comment">// 发送给其它客户端</span></span><br><span class="line">                        output.writeUTF(textName);</span><br><span class="line">                        output.flush();</span><br><span class="line">                        output.writeLong(textLength);</span><br><span class="line">                        output.flush();</span><br><span class="line">                    }</span><br><span class="line">                }</span><br><span class="line">                <span class="comment">// 发送文件内容</span></span><br><span class="line">                <span class="keyword">int</span> length = -<span class="number">1</span>;</span><br><span class="line">                <span class="keyword">long</span> curLength = <span class="number">0</span>;</span><br><span class="line">                <span class="keyword">byte</span>[] buff = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">1024</span>];</span><br><span class="line">                <span class="keyword">while</span> ((length = input.read(buff)) &gt; <span class="number">0</span>) {</span><br><span class="line">                    curLength += length;</span><br><span class="line">                    <span class="keyword">for</span>(Socket socket: ServerFileThread.list) {</span><br><span class="line">                        output = <span class="keyword">new</span> DataOutputStream(socket.getOutputStream());  <span class="comment">// 输出流</span></span><br><span class="line">                        <span class="keyword">if</span>(socket != nowSocket) {  <span class="comment">// 发送给其它客户端</span></span><br><span class="line">                            output.write(buff, <span class="number">0</span>, length);</span><br><span class="line">                            output.flush();</span><br><span class="line">                        }</span><br><span class="line">                    }</span><br><span class="line">                    <span class="keyword">if</span>(curLength == textLength) {  <span class="comment">// 强制退出</span></span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    }</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">        } <span class="keyword">catch</span> (Exception e) {</span><br><span class="line">            ServerFileThread.list.remove(nowSocket);  <span class="comment">// 线程关闭，移除相应套接字</span></span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h2 id="二、运行效果"><a href="#二、运行效果" class="headerlink" title="二、运行效果"></a>二、运行效果</h2><h3 id="2-1-初始化"><a href="#2-1-初始化" class="headerlink" title="2.1 初始化"></a>2.1 初始化</h3><ul><li>服务器端（先运行Server.java）<br><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly90dmE0LnNpbmFpbWcuY24vbGFyZ2UvMDA2VnJKQUpseTFnN3kxYW5sc2ZnajMwYngwZG9qcmUuanBn?x-oss-process=image/format,png" alt="Snipaste_2019-10-14_21-07-09"></li><li>登录界面（接着运行Client.java，运行一次生成一个登录界面）<br><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly90dmEyLnNpbmFpbWcuY24vbGFyZ2UvMDA2VnJKQUpseTFnN3kxYncwbHp4ajMwaGkwYzZteGsuanBn?x-oss-process=image/format,png" alt="Snipaste_2019-10-14_21-08-44"></li></ul><h3 id="2-2-登录成功"><a href="#2-2-登录成功" class="headerlink" title="2.2 登录成功"></a>2.2 登录成功</h3><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly90dmF4NC5zaW5haW1nLmNuL2xhcmdlLzAwNlZySkFKbHkxZzd5MWVjdWRkMGozMG1tMGVpZGdhLmpwZw?x-oss-process=image/format,png" alt="Snipaste_2019-10-14_21-12-23"><br><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly90dmExLnNpbmFpbWcuY24vbGFyZ2UvMDA2VnJKQUpseTFnN3kxZjBudGMzajMwY3owZWZ0OHQuanBn?x-oss-process=image/format,png" alt="Snipaste_2019-10-14_21-13-03"></p><h3 id="2-3-发送信息"><a href="#2-3-发送信息" class="headerlink" title="2.3 发送信息"></a>2.3 发送信息</h3><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly90dmF4NC5zaW5haW1nLmNuL2xhcmdlLzAwNlZySkFKZ3kxZzd5MnRqaGJwcmozMHVxMGR5d2ZiLmpwZw?x-oss-process=image/format,png" alt="Snipaste_2019-10-14_22-01-35"></p><h3 id="2-4-发送文件"><a href="#2-4-发送文件" class="headerlink" title="2.4 发送文件"></a>2.4 发送文件</h3><p>打开文件我设置了默认路径是在桌面。接受文件需要先在桌面创建一个名为“接受文件”的文件夹，用于存放所有用户接收的文件。<br><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly90dmE0LnNpbmFpbWcuY24vbGFyZ2UvMDA2VnJKQUpneTFnN3kyeDNzbWNpajMwbGkwZWtteTYuanBn?x-oss-process=image/format,png" alt="Snipaste_2019-10-14_22-05-00"></p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
      
      
      <categories>
          
          <category> Java实验/项目 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> 聊天系统 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hexo：修改永久链接的默认格式</title>
      <link href="/article/3b228ab0.html"/>
      <url>/article/3b228ab0.html</url>
      
        <content type="html"><![CDATA[<h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p>如果你的文章名称是中文的，那么 Hexo 默认生成的永久链接也会有中文，这样不利于 SEO，且  gitment 评论对中文链接也不支持。</p><a id="more"></a><p>在 Hexo 根目录下的 _config.yml 文件采用初始设置。这里因为用“年月日”会让文章链接的层次太深，所以我用”article”代替：</p><figure class="highlight yaml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># permalink: :year/:month/:day/:title/</span></span><br><span class="line"><span class="attr">permalink:</span> <span class="string">article/:title.html</span></span><br><span class="line"><span class="attr">permalink_defaults:</span></span><br></pre></td></tr></tbody></table></figure><ul><li><p>生成的文章链接就是（标题为“我的个人博客”）：</p><p>  https://[你的网站域名]/article/我的个人博客.html</p></li></ul><p>链接中出现中文显然不太好，所以下面给出三种替代中的方法。</p><h2 id="三种解决方案"><a href="#三种解决方案" class="headerlink" title="三种解决方案"></a>三种解决方案</h2><h3 id="1-1-安装插件方法一（推荐）"><a href="#1-1-安装插件方法一（推荐）" class="headerlink" title="1.1 安装插件方法一（推荐）"></a>1.1 安装插件方法一（推荐）</h3><p>在 Hexo 根目录下使用 git bash 执行命令：</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install hexo-abbrlink --save</span><br></pre></td></tr></tbody></table></figure><p>在 Hexo 根目录下的 _config.yml 文件，修改为如下配置： </p><figure class="highlight yml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># permalink: :year/:month/:day/:title/</span></span><br><span class="line"><span class="comment"># permalink: article/:title/</span></span><br><span class="line"><span class="attr">permalink:</span> <span class="string">article/:abbrlink.html</span></span><br><span class="line"><span class="attr">abbrlink:</span></span><br><span class="line"><span class="attr">  alg:</span> <span class="string">crc32</span>  <span class="comment"># 算法：crc16(default) and crc32</span></span><br><span class="line"><span class="attr">  rep:</span> <span class="string">hex</span>    <span class="comment"># 进制：dec(default) and hex</span></span><br><span class="line"><span class="attr">permalink_defaults:</span></span><br></pre></td></tr></tbody></table></figure><p>然后在 git bash 按顺序运行如下命令：</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">hexo clean <span class="comment">#清除缓存 网页正常情况下可以忽略此条命令</span></span><br><span class="line">hexo g <span class="comment">#生成静态网页</span></span><br><span class="line">hexo d <span class="comment">#开始部署</span></span><br></pre></td></tr></tbody></table></figure><p>再打开网站的文件就可以看到效果。</p><ul><li><p>效果（其中60762就是随机生成的）</p><p>  https://[你的网站域名]/article/60762.html</p></li></ul><h3 id="1-2-安装插件方法二"><a href="#1-2-安装插件方法二" class="headerlink" title="1.2 安装插件方法二"></a>1.2 安装插件方法二</h3><p>中文链接转拼音</p><p>在 Hexo 根目录下使用 git bash 执行命令：</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i hexo-permalink-pinyin --save</span><br></pre></td></tr></tbody></table></figure><p>在 Hexo 根目录下的 _config.yml 文件中，修改以下的配置项：</p><figure class="highlight yml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">permalink:</span> <span class="string">article/:title.html</span></span><br><span class="line"><span class="attr">permalink_pinyin:</span></span><br><span class="line"><span class="attr">  enable:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">  separator:</span> <span class="string">'-'</span> <span class="comment"># default: '-'</span></span><br><span class="line"><span class="attr">permalink_defaults:</span></span><br></pre></td></tr></tbody></table></figure><p>然后在 git bash 按顺序运行如下命令：</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">hexo clean <span class="comment">#清除缓存 网页正常情况下可以忽略此条命令</span></span><br><span class="line">hexo g <span class="comment">#生成静态网页</span></span><br><span class="line">hexo d <span class="comment">#开始部署</span></span><br></pre></td></tr></tbody></table></figure><p>再打开网站的文件就可以看到效果。</p><ul><li><p>效果（标题为“我的个人博客”）</p><p>  https://[你的网站域名]/article/wo-de-ge-ren-bo-ke.html</p></li></ul><h3 id="1-3-采用urlname"><a href="#1-3-采用urlname" class="headerlink" title="1.3 采用urlname"></a>1.3 采用urlname</h3><p>在写每篇md文章的时候，在 Front-matter 里加上urlname：</p><figure class="highlight yaml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">title:</span> <span class="string">typora-vue-theme主题介绍</span></span><br><span class="line"><span class="attr">date:</span> <span class="number">2018</span><span class="bullet">-09</span><span class="bullet">-07</span> <span class="number">09</span><span class="string">:25:00</span></span><br><span class="line"><span class="attr">urlname:</span> <span class="number">2019102101</span></span><br><span class="line"><span class="meta">---</span></span><br></pre></td></tr></tbody></table></figure><p>在 Hexo 根目录下的 _config.yml 文件中，修改以下的配置项：</p><figure class="highlight yml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">permalink:</span> <span class="string">article/:urlname.html</span>  <span class="comment"># urlname值文章里必须填写，格式201905260105</span></span><br><span class="line"><span class="attr">permalink_defaults:</span></span><br></pre></td></tr></tbody></table></figure><p>然后在 git bash 按顺序运行如下命令：</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">hexo clean <span class="comment">#清除缓存 网页正常情况下可以忽略此条命令</span></span><br><span class="line">hexo g <span class="comment">#生成静态网页</span></span><br><span class="line">hexo d <span class="comment">#开始部署</span></span><br></pre></td></tr></tbody></table></figure><p>再打开网站的文件就可以看到效果。</p><ul><li><p>效果</p><p>  https://[你的网站域名]/article/2019102101.html</p></li></ul><h3 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h3><p>第一种方法是我试过中最好的；第三次之，因为每次都要手动加上urlname；而第二种，当文章的中文标题名字过长时，效果并不好。</p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
      
      
      <categories>
          
          <category> 其它 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> hexo </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>【剑指Offer】复杂链表的复制</title>
      <link href="/article/60762.html"/>
      <url>/article/60762.html</url>
      
        <content type="html"><![CDATA[<h3 id="【题目】"><a href="#【题目】" class="headerlink" title="【题目】"></a>【题目】</h3><p> 输入一个复杂链表（每个节点中有节点值，以及两个指针，一个指向下一个节点，另一个特殊指针指向任意一个节点），返回结果为复制后复杂链表的head。（注意，输出结果中请不要返回参数中的节点引用，否则判题程序会直接返回空） </p><a id="more"></a><h3 id="【思路】"><a href="#【思路】" class="headerlink" title="【思路】"></a>【思路】</h3><p>思路主要是在原来链表的基础上进行复制，分三步：</p><p>（1）遍历一次，在原链表每个节点后面新建一个和该节点值相同的节点，并插入进去。</p><p>（2）再遍历一次，处理原链表的random指针，把它复制到新建节点上面。</p><p>（3）最后遍历一次，把复制的链表抽离出来。</p><p>注意：第三步抽离的时候一定要把和原链表连接的所有指针断开。</p><h3 id="【代码】"><a href="#【代码】" class="headerlink" title="【代码】"></a>【代码】</h3><figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">struct RandomListNode {</span></span><br><span class="line"><span class="comment">    int label;</span></span><br><span class="line"><span class="comment">    struct RandomListNode *next, *random;</span></span><br><span class="line"><span class="comment">    RandomListNode(int x) :</span></span><br><span class="line"><span class="comment">            label(x), next(nullptr), random(nullptr) {</span></span><br><span class="line"><span class="comment">    }</span></span><br><span class="line"><span class="comment">};</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> {</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">RandomListNode* <span class="title">Clone</span><span class="params">(RandomListNode* pHead)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">        <span class="keyword">if</span> (pHead == <span class="literal">nullptr</span>) {</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">nullptr</span>;</span><br><span class="line">        }</span><br><span class="line">        RandomListNode *pNode = pHead;</span><br><span class="line">        <span class="comment">// 第一步，复制next指针所指的结点</span></span><br><span class="line">        <span class="keyword">while</span> (pNode != <span class="literal">nullptr</span>) {</span><br><span class="line">            RandomListNode *pClone = <span class="keyword">new</span> RandomListNode(pNode-&gt;label);</span><br><span class="line">            pClone-&gt;next = pNode-&gt;next;</span><br><span class="line">            pNode-&gt;next = pClone;</span><br><span class="line"></span><br><span class="line">            pNode = pClone-&gt;next;</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">// 第二步，处理random指针</span></span><br><span class="line">        pNode = pHead;</span><br><span class="line">        <span class="keyword">while</span> (pNode != <span class="literal">nullptr</span>) {</span><br><span class="line">            <span class="keyword">if</span> (pNode-&gt;random == <span class="literal">nullptr</span>) {</span><br><span class="line">                pNode-&gt;next-&gt;random = <span class="literal">nullptr</span>;</span><br><span class="line">            }</span><br><span class="line">            <span class="keyword">else</span> {</span><br><span class="line">                pNode-&gt;next-&gt;random = pNode-&gt;random-&gt;next;</span><br><span class="line">            }</span><br><span class="line">            pNode = pNode-&gt;next-&gt;next;</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">// 第三步，抽离出复制好的链表</span></span><br><span class="line">        RandomListNode *oldNode = pHead;</span><br><span class="line">        RandomListNode *newHead = pHead-&gt;next;</span><br><span class="line">        pNode = pHead-&gt;next;</span><br><span class="line">        <span class="keyword">while</span> (pNode != <span class="literal">nullptr</span>) {</span><br><span class="line">            oldNode-&gt;next = pNode-&gt;next;</span><br><span class="line">            <span class="keyword">if</span> (pNode-&gt;next != <span class="literal">nullptr</span>) {</span><br><span class="line">                pNode-&gt;next = pNode-&gt;next-&gt;next;</span><br><span class="line">            }</span><br><span class="line">            pNode = pNode-&gt;next;</span><br><span class="line">            oldNode = oldNode-&gt;next;</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">// 返回新链表的头指针</span></span><br><span class="line">        <span class="keyword">return</span> newHead;</span><br><span class="line">    }</span><br><span class="line">};</span><br></pre></td></tr></tbody></table></figure><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
      
      
      <categories>
          
          <category> 【剑指Offer】 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 链表 </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
